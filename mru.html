<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MRU — Visuale centrata + Auto migliorata</title>
<style>
  :root{
    --bg1:#e9eef5; --bg2:#dbe6f3; --panel:#ffffff; --ink:#0f172a; --muted:#64748b; --blue:#2563eb; --orange:#f97316;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:linear-gradient(180deg,var(--bg1),var(--bg2)); color:var(--ink); padding:1rem;}
  header{display:flex; justify-content:space-between; align-items:center; gap:1rem; margin-bottom:8px}
  h1{margin:0; font-size:clamp(1.1rem,1.6rem,2rem)}
  .layout{display:grid; gap:1rem; grid-template-columns:1fr;}
  @media (min-width: 980px){.layout{grid-template-columns: 1.2fr .8fr}}
  .card{background:var(--panel); border-radius:16px; box-shadow:0 10px 30px rgba(15,23,42,.08); padding:12px}
  canvas{width:100%; height:100%; display:block; border-radius:12px}
  .scene{aspect-ratio:16/9}
  .graph{aspect-ratio:16/9}
  .controls{display:flex; flex-wrap:wrap; gap:.8rem; align-items:center; margin-top:.6rem}
  .ctrl{background:var(--panel); padding:.65rem .9rem; border-radius:12px; box-shadow:0 6px 16px rgba(15,23,42,.06); display:flex; align-items:center; gap:.5rem}
  input[type=range]{width:220px}
  .btn{border:0; background:var(--blue); color:#fff; padding:.6rem .9rem; border-radius:10px; font-weight:700; cursor:pointer}
  .btn.secondary{background:#0f172a}
  .pill{background:#0ea5e9; color:#fff; padding:.35rem .7rem; border-radius:999px; font-weight:700; display:inline-block; margin-right:.4rem}
  .legend{position:absolute; right:.6rem; top:.6rem; background:rgba(255,255,255,.85); padding:.35rem .6rem; border-radius:8px; font-size:.8rem; box-shadow:0 2px 8px rgba(0,0,0,.08)}
</style>
</head>
<body>
  <header>
    <h1>MRU — Punto centrato e auto migliorata</h1>
    <div style="font-size:.9rem;color:#334155">Il punto nel grafico resta al centro. L'auto ha tettuccio e finestrino migliorati.</div>
  </header>

  <section class="layout">
    <div class="card" style="position:relative">
      <div class="legend">v > 0: vista da dietro • v < 0: vista da davanti</div>
      <canvas id="scene" class="scene"></canvas>
      <div class="controls">
        <div class="ctrl"><label for="vel">Velocità (m/s)</label><input id="vel" type="range" min="-40" max="40" step="1" value="18"><strong id="velVal">18</strong></div>
        <button id="pp" class="btn">Pausa</button>
        <button id="reset" class="btn secondary">Reset</button>
        <span class="pill" id="kpiT">t = 0.0 s</span>
        <span class="pill" id="kpiS">s = 0.0 m</span>
        <span class="pill" id="kpiV">v = 18 m/s</span>
      </div>
    </div>

    <div class="card" style="position:relative">
      <div class="legend">Grafico centrato: il punto rimane fisso al centro, gli assi si espandono</div>
      <canvas id="graph" class="graph"></canvas>
    </div>
  </section>

<script>
(function(){
  const scene = document.getElementById('scene');
  const graph = document.getElementById('graph');
  const ctx = scene.getContext('2d');
  const gtx = graph.getContext('2d');
  const velR = document.getElementById('vel');
  const velVal = document.getElementById('velVal');
  const btnPP = document.getElementById('pp');
  const btnReset = document.getElementById('reset');
  const kpiT = document.getElementById('kpiT');
  const kpiS = document.getElementById('kpiS');
  const kpiV = document.getElementById('kpiV');

  let v = Number(velR.value);
  let t = 0;
  let s = 0;
  let playing = true;
  const points = [];

  velR.addEventListener('input',()=>{v=Number(velR.value);velVal.textContent=v;kpiV.textContent=`v = ${v} m/s`;});
  btnPP.addEventListener('click',()=>{playing=!playing;btnPP.textContent=playing?'Pausa':'Riprendi';});
  btnReset.addEventListener('click',()=>{t=0;s=0;points.length=0;});

  function drawScene(){
    const w=scene.clientWidth,h=scene.clientHeight;ctx.clearRect(0,0,w,h);
    const cx=w/2;const cy=h*0.78;const carW=120,carH=50;const front=v<0;

    // sfondo
    const sky=ctx.createLinearGradient(0,0,0,h*0.6);sky.addColorStop(0,'#cfe3ff');sky.addColorStop(1,'#f2f7ff');ctx.fillStyle=sky;ctx.fillRect(0,0,w,h);
    ctx.fillStyle='#3b414a';ctx.fillRect(0,h*0.6,w,h*0.4);

    // auto con tettuccio
    ctx.save();
    ctx.translate(cx,cy);
    if(front) ctx.scale(-1,1);
    ctx.fillStyle='#2563eb';ctx.beginPath();ctx.roundRect(-carW/2,-carH/2,carW,carH,10);ctx.fill();
    // tettuccio
    ctx.fillStyle='#1e40af';ctx.fillRect(-carW*0.25,-carH*0.65,carW*0.5,carH*0.3);
    // finestrino
    ctx.fillStyle='#93c5fd';ctx.fillRect(-carW*0.2,-carH*0.55,carW*0.4,carH*0.25);
    // fari o luci
    if(front){ctx.fillStyle='#fde68a';ctx.fillRect(-carW/2+8,-carH*0.15,14,10);ctx.fillRect(carW/2-22,-carH*0.15,14,10);}else{ctx.fillStyle='#ef4444';ctx.fillRect(-carW/2+8,carH*0.05,14,10);ctx.fillRect(carW/2-22,carH*0.05,14,10);}
    ctx.restore();

    // freccia velocità
    ctx.strokeStyle='#f97316';ctx.lineWidth=4;ctx.beginPath();ctx.moveTo(cx,cy-carH*1.1);ctx.lineTo(cx+v*3,cy-carH*1.1);ctx.stroke();
  }

  function drawGraph(){
    const w=graph.clientWidth,h=graph.clientHeight;gtx.clearRect(0,0,w,h);
    gtx.fillStyle='#fff';gtx.fillRect(0,0,w,h);
    gtx.strokeStyle='#cbd5e1';gtx.lineWidth=1.5;gtx.strokeRect(48,16,w-64,h-48);

    // centro punto fisso, finestra che si muove
    const halfWindow=10; // secondi prima e dopo il punto centrale
    const tMin=Math.max(0,t-halfWindow);
    const tMax=t+halfWindow;

    // y parte da 0 in basso e cresce verso l'alto
    const sVals=points.filter(p=>p.t>=tMin&&p.t<=tMax).map(p=>p.s);
    const sMax=Math.max(0,...sVals,10);
    const sMin=0;

    const tx=tt=>48+((tt-tMin)/(tMax-tMin))*(w-64);
    const sy=ss=>h-32-((ss-sMin)/(sMax-sMin||1))*(h-64);

    // assi
    gtx.strokeStyle='#aaa';gtx.beginPath();gtx.moveTo(50,h-30);gtx.lineTo(w-20,h-30);gtx.moveTo(50,h-30);gtx.lineTo(50,20);gtx.stroke();

    // curva
    gtx.strokeStyle='#2563eb';gtx.lineWidth=2;gtx.beginPath();
    let started=false;
    for(const p of points){if(p.t<tMin||p.t>tMax)continue;const X=tx(p.t),Y=sy(p.s);if(!started){gtx.moveTo(X,Y);started=true;}else{gtx.lineTo(X,Y);}}
    gtx.stroke();

    // punto corrente centrato
    const Xc=tx(t),Yc=sy(s);gtx.fillStyle='#2563eb';gtx.beginPath();gtx.arc(Xc,Yc,4,0,Math.PI*2);gtx.fill();
    gtx.strokeStyle='#94a3b8';gtx.setLineDash([6,6]);gtx.beginPath();gtx.moveTo(48,Yc);gtx.lineTo(w-16,Yc);gtx.moveTo(Xc,16);gtx.lineTo(Xc,h-32);gtx.stroke();gtx.setLineDash([]);
  }

  let last=performance.now();
  function loop(now){
    const dt=(now-last)/1000;last=now;if(playing){t+=dt;s+=v*dt;}
    if(points.length===0||t-points[points.length-1].t>=0.02){points.push({t,s});if(points.length>5000)points.splice(0,1000);}
    kpiT.textContent=`t = ${t.toFixed(1)} s`;kpiS.textContent=`s = ${s.toFixed(1)} m`;
    drawScene();drawGraph();requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
