<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MRU — Visuale Dinamica (Davanti/Dietro)</title>
<style>
  body { font-family: 'Inter', sans-serif; background: linear-gradient(180deg,#e9eef5,#dbe6f3); margin:0; padding:1rem; display:flex; flex-direction:column; align-items:center; }
  canvas { background:white; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.1); margin:10px; }
  .controls { background:white; padding:1rem 2rem; border-radius:1rem; box-shadow:0 2px 10px rgba(0,0,0,0.1); text-align:center; }
  input[type=range] { width:200px; }
  button { margin-left:10px; padding:0.4rem 0.8rem; border:none; border-radius:8px; background:#2563eb; color:white; cursor:pointer; }
  button:hover { background:#1e3a8a; }
</style>
</head>
<body>
<h1>Simulazione MRU — Visuale dinamica</h1>
<canvas id="scene" width="600" height="300"></canvas>
<canvas id="graph" width="600" height="300"></canvas>
<div class="controls">
  <label>Velocità (m/s): <input type="range" id="vel" min="-40" max="40" value="20"> <span id="velVal">20</span></label>
  <button id="reset">Reset</button>
</div>

<script>
const scene = document.getElementById('scene');
const ctx = scene.getContext('2d');
const graph = document.getElementById('graph');
const gtx = graph.getContext('2d');

const velSlider = document.getElementById('vel');
const velVal = document.getElementById('velVal');
const resetBtn = document.getElementById('reset');

let v = parseFloat(velSlider.value);
let s = 0; // posizione
let t = 0; // tempo
let lastTime = null;
let graphPoints = [];
let dir = 1; // 1 = avanti, -1 = indietro

velSlider.addEventListener('input', () => {
  const newV = parseFloat(velSlider.value);
  // Mantieni lo spazio accumulato, cambia solo la velocità
  v = newV;
  dir = v >= 0 ? 1 : -1;
  velVal.textContent = v;
});

resetBtn.addEventListener('click', () => {
  s = 0; t = 0; graphPoints = [];
});

function drawScene() {
  ctx.clearRect(0, 0, scene.width, scene.height);

  // Sfondo e strada
  const w = scene.width, h = scene.height;
  ctx.fillStyle = '#bcd1e6';
  ctx.fillRect(0, 0, w, h);
  ctx.fillStyle = '#3b414a';
  ctx.beginPath();
  ctx.moveTo(w/2 - 120, h*0.55);
  ctx.lineTo(w/2 + 120, h*0.55);
  ctx.lineTo(w, h);
  ctx.lineTo(0, h);
  ctx.closePath();
  ctx.fill();

  // Auto vista da dietro o davanti
  const carY = h * 0.75;
  const carW = 120, carH = 40;
  const isFront = v < 0;

  ctx.save();
  ctx.translate(w/2, carY);
  if (isFront) ctx.scale(-1, 1); // ribalta visuale

  // Corpo
  ctx.fillStyle = '#2563eb';
  ctx.beginPath();
  ctx.roundRect(-carW/2, -carH/2, carW, carH, 10);
  ctx.fill();

  // Finestrino
  ctx.fillStyle = '#93c5fd';
  ctx.fillRect(-carW*0.2, -carH*0.4, carW*0.4, carH*0.25);

  // Luci posteriori o fari
  if (isFront) {
    ctx.fillStyle = '#fef08a'; // fari gialli
    ctx.fillRect(-carW/2+5, -carH/4, 10, 10);
    ctx.fillRect(carW/2-15, -carH/4, 10, 10);
  } else {
    ctx.fillStyle = '#ef4444'; // luci posteriori rosse
    ctx.fillRect(-carW/2+5, carH/4, 10, 10);
    ctx.fillRect(carW/2-15, carH/4, 10, 10);
  }

  ctx.restore();

  // Freccia di velocità
  ctx.strokeStyle = '#f97316';
  ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.moveTo(w/2, carY - 50);
  ctx.lineTo(w/2 + v * 2, carY - 50);
  ctx.stroke();
}

function drawGraph() {
  gtx.clearRect(0, 0, graph.width, graph.height);
  const w = graph.width, h = graph.height;

  // Assi
  gtx.strokeStyle = '#aaa';
  gtx.lineWidth = 2;
  gtx.beginPath();
  gtx.moveTo(50, h - 30);
  gtx.lineTo(w - 20, h - 30);
  gtx.moveTo(50, h - 30);
  gtx.lineTo(50, 20);
  gtx.stroke();

  // Grafico
  gtx.strokeStyle = '#2563eb';
  gtx.lineWidth = 2;
  gtx.beginPath();
  graphPoints.forEach((p, i) => {
    const x = 50 + p.t * 10;
    const y = h - 30 - p.s * 0.3;
    if (i === 0) gtx.moveTo(x, y);
    else gtx.lineTo(x, y);
  });
  gtx.stroke();
}

function update(dt) {
  s += v * dt;
  t += dt;
  graphPoints.push({ t, s });
}

function loop(timestamp) {
  if (!lastTime) lastTime = timestamp;
  const dt = (timestamp - lastTime) / 1000;
  lastTime = timestamp;

  update(dt);
  drawScene();
  drawGraph();

  requestAnimationFrame(loop);
}

requestAnimationFrame(loop);
</script>
</body>
</html>
