<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Moto armonico — proiezione del moto circolare</title>
<script src="https://cdn.jsdelivr.net/npm/p5@1.9.2/lib/p5.min.js"></script>
<style>
:root {
  --bg:#f7f7f7;--card:#ffffff;--text:#222;--muted:#666;
  --accent:#0072B2;--omega:#3BAFDA;--phi:#F4B400;
  --control:#eaeaea;--ctl-border:#d0d0d0;
}
body{
  margin:0;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  color:var(--text);background:var(--bg);
}
.wrap{
  max-width:1100px;margin:24px auto;padding:16px;
  background:var(--card);border-radius:16px;
  box-shadow:0 8px 24px rgba(0,0,0,.08);
}
h1{margin:0 0 8px;font-size:22px;}
.sub{color:var(--muted);margin-bottom:16px;}
#canvas-holder{width:100%;border:1px solid #eee;border-radius:12px;overflow:hidden;}
.controls{
  display:flex;flex-wrap:wrap;gap:10px;margin-top:14px;
  align-items:flex-start;justify-content:space-between;
}
.group{
  flex:1 1 240px;
  background:var(--control);
  border:1px solid var(--ctl-border);
  border-radius:10px;padding:10px;min-width:220px;
}
.group h3{
  margin:0 0 8px;font-size:13px;color:var(--muted);
  text-transform:uppercase;letter-spacing:.04em;
}
.row{display:flex;flex-wrap:wrap;gap:10px;align-items:center;}
input[type="range"]{flex:1;min-width:120px;accent-color:var(--accent);}
select{flex:1;padding:6px;border-radius:6px;border:1px solid var(--ctl-border);font-size:15px;}
.btn{
  appearance:none;border:0;padding:10px 14px;border-radius:10px;
  cursor:pointer;background:#ccc;transition:transform .05s ease,box-shadow .2s ease;
  font-weight:600;box-shadow:0 2px 0 rgba(0,0,0,.15);
}
.btn:active{transform:translateY(1px);box-shadow:0 1px 0 rgba(0,0,0,.2);}
.btn.accent{background:var(--accent);color:#fff;}
.btn.omega{background:var(--omega);color:#083042;}
.btn.phi{background:var(--phi);color:#5c4300;}
.label-chip{
  background:#fff;border:1px solid var(--ctl-border);
  border-radius:999px;padding:6px 10px;font-weight:600;white-space:nowrap;
}
/* responsive */
@media (max-width:820px){
  canvas{width:100%!important;height:auto!important;}
}
@media (max-width:600px){
  .controls{flex-direction:column;}
  .group{width:100%;}
  input[type="range"]{display:none;}    /* nasconde slider su mobile */
  select{display:block;}                /* mostra select */
}
@media (min-width:601px){
  select{display:none;}                 /* nasconde select su desktop */
}
</style>
</head>
<body>
<div class="wrap">
  <h1>Moto armonico da moto circolare</h1>
  <div class="sub">Sinistra: cerchio e proiezione su x • Destra: y(t) = r · f(ωt + φ)</div>
  <div id="canvas-holder"></div>

  <div class="controls">
    <div class="group" style="flex-basis:100%;">
      <div class="row">
        <button id="btn-toggle" class="btn accent">Funzione: SENO</button>
        <button id="btn-pause" class="btn">Blocca</button>
        <button id="btn-reset" class="btn">Reset</button>
      </div>
    </div>

    <div class="group">
      <h3>Raggio r</h3>
      <div class="row">
        <input id="slider-r" type="range" min="0.2" max="2.0" step="0.2" value="1.0" />
        <select id="select-r">
          <option value="0.2">0.2</option>
          <option value="0.4">0.4</option>
          <option value="0.6">0.6</option>
          <option value="0.8">0.8</option>
          <option value="1.0" selected>1.0</option>
          <option value="1.2">1.2</option>
          <option value="1.4">1.4</option>
          <option value="1.6">1.6</option>
          <option value="1.8">1.8</option>
          <option value="2.0">2.0</option>
        </select>
        <span class="label-chip">r = <span id="label-r">1.0</span></span>
      </div>
    </div>

    <div class="group">
      <h3>Velocità angolare ω</h3>
      <div class="row"><button id="btn-omega" class="btn omega">ω = 1</button></div>
    </div>

    <div class="group">
      <h3>Fase iniziale φ</h3>
      <div class="row"><button id="btn-phi" class="btn phi">φ = 0</button></div>
    </div>
  </div>
</div>

<script>
/* === Parametri discreti === */
const omegaValues=[1,2,3,4,5];
const phiValues=[0,Math.PI/4,Math.PI/2,3*Math.PI/4,Math.PI,5*Math.PI/4,3*Math.PI/2,7*Math.PI/4,2*Math.PI];
const phiLabels={0:"0",[Math.PI/4]:"π/4",[Math.PI/2]:"π/2",[3*Math.PI/4]:"3π/4",[Math.PI]:"π",[5*Math.PI/4]:"5π/4",[3*Math.PI/2]:"3π/2",[7*Math.PI/4]:"7π/4",[2*Math.PI]:"2π"};

/* === Stato === */
let useSine=true,omegaIndex=0,phiIndex=0,r=1.0,paused=false;
let t=0,lastMillis=null;const windowSec=10,lead=1.0;const trail=[];
let W=1000,H=460,left={x:0,y:0,w:0,h:0},right={x:0,y:0,w:0,h:0};
const elR=document.getElementById('slider-r');
const elSelect=document.getElementById('select-r');
const elRLabel=document.getElementById('label-r');
const btnToggle=document.getElementById('btn-toggle'),btnPause=document.getElementById('btn-pause'),btnReset=document.getElementById('btn-reset'),btnOmega=document.getElementById('btn-omega'),btnPhi=document.getElementById('btn-phi');
const holder=document.getElementById('canvas-holder');

/* === p5 === */
let sketch=(p)=>{
  p.setup=()=>{
    const bound=holder.getBoundingClientRect();
    W=Math.max(320,Math.min(bound.width,1100));
    H=W>600?Math.floor(W*0.46):Math.floor(W*0.9);
    const cnv=p.createCanvas(W,H);cnv.parent(holder);
    layoutPanels();p.frameRate(60);
  };
  p.windowResized=()=>{
    const bound=holder.getBoundingClientRect();
    W=Math.max(320,Math.min(bound.width,1100));
    H=W>600?Math.floor(W*0.46):Math.floor(W*0.9);
    p.resizeCanvas(W,H);layoutPanels();
  };
  p.draw=()=>{
    p.background(255);
    const now=p.millis()/1000;let dt=now-(lastMillis??now);lastMillis=now;dt=Math.min(dt,0.05);
    if(!paused)t+=dt;
    const omega=omegaValues[omegaIndex],phi=phiValues[phiIndex];
    const phase=omega*t+phi,yt=r*(useSine?Math.sin(phase):Math.cos(phase));
    trail.push({t,y:yt});
    const tMin=Math.max(0,t-windowSec);
    while(trail.length&&trail[0].t<tMin-2)trail.shift();
    drawLeft(p,omega,phi);
    drawRight(p,t,yt);
  };
};
new p5(sketch);

/* === Layout panels === */
function layoutPanels(){
  const pad=20,gap=20;
  if(W<720){
    const panelH=(H-pad*2-gap)/2;
    left={x:pad,y:pad,w:W-pad*2,h:panelH};
    right={x:pad,y:pad+panelH+gap,w:W-pad*2,h:panelH};
  }else{
    const panelW=(W-pad*2-gap)/2,panelH=H-pad*2;
    left={x:pad,y:pad,w:panelW,h:panelH};
    right={x:pad+panelW+gap,y:pad,w:panelW,h:panelH};
  }
}
function drawAxes(p,x,y,w,h){p.push();p.stroke(0);p.line(x,y+h/2,x+w,y+h/2);p.line(x+w/2,y,x+w/2,y+h);p.pop();}
function drawLeft(p,omega,phi){
  const cx=left.x+left.w/2,cy=left.y+left.h/2;
  const Rpx=r*(Math.min(left.w,left.h)*0.38/2);
  p.push();p.noFill();p.stroke(160);p.circle(cx,cy,2*Rpx);p.pop();
  const angle=-omega*t-phi,xRot=cx+Rpx*Math.cos(angle),yRot=cy+Rpx*Math.sin(angle);
  p.push();p.stroke(220,0,0);p.drawingContext.setLineDash([6,4]);p.line(xRot,cy,xRot,yRot);p.pop();
  p.push();p.fill(30,144,255);p.circle(xRot,cy,9);p.fill(220,50,47);p.circle(xRot,yRot,11);p.pop();
  drawAxes(p,left.x,left.y,left.w,left.h);
}
function drawRight(p,tNow,yNow){
  const x0=right.x,y0=right.y,w=right.w,h=right.h;
  const tStart=Math.max(0,tNow-(windowSec-lead)),tEnd=tStart+windowSec;
  drawAxes(p,x0,y0,w,h);
  p.push();p.stroke(235);
  for(let i=-2;i<=2;i++){const yy=p.map(i,-2,2,y0+h,y0);p.line(x0,yy,x0+w,yy);}p.pop();
  p.push();p.noFill();p.stroke(0,114,178);p.beginShape();
  for(const pt of trail){
    if(pt.t<tStart-1||pt.t>tEnd+1)continue;
    p.vertex(p.map(pt.t,tStart,tEnd,x0,x0+w),p.map(pt.y,-2,2,y0+h,y0));
  }
  p.endShape();p.pop();
  const xDot=p.map(tNow,tStart,tEnd,x0,x0+w),yDot=p.map(yNow,-2,2,y0+h,y0);
  p.push();p.fill(220,50,47);p.circle(xDot,yDot,12);p.pop();
}

/* === Interazioni === */
elR.addEventListener('input',()=>{r=parseFloat(elR.value);elRLabel.textContent=r.toFixed(1);softRefresh();});
elSelect.addEventListener('change',()=>{r=parseFloat(elSelect.value);elRLabel.textContent=r.toFixed(1);softRefresh();});
btnToggle.addEventListener('click',()=>{useSine=!useSine;btnToggle.textContent='Funzione: '+(useSine?'SENO':'COSENO');softRefresh();});
btnPause.addEventListener('click',()=>{paused=!paused;btnPause.textContent=paused?'Riprendi':'Blocca';softRefresh(0);});
btnReset.addEventListener('click',()=>{t=0;trail.length=0;softRefresh(0);});
btnOmega.addEventListener('click',()=>{omegaIndex=(omegaIndex+1)%omegaValues.length;btnOmega.textContent=`ω = ${omegaValues[omegaIndex]}`;softRefresh();});
btnPhi.addEventListener('click',()=>{phiIndex=(phiIndex+1)%phiValues.length;btnPhi.textContent=`φ = ${phiLabels[phiValues[phiIndex]]}`;softRefresh(0);});
function softRefresh(pauseMs=120){
  const wasPaused=paused;paused=true;
  const omega=omegaValues[omegaIndex],phi=phiValues[phiIndex];
  const phase=omega*t+phi;
  const y=r*(useSine?Math.sin(phase):Math.cos(phase));
  trail.push({t,y});
  setTimeout(()=>paused=wasPaused,pauseMs);
}
window.dispatchEvent(new Event('resize'));
</script>
</body>
</html>
